<?xml version="1.0" encoding="UTF-8"?>
<Export generator="IRIS" version="26" zv="IRIS for Windows (x86-64) 2020.1 (Build 215U)" ts="2021-07-22 09:42:03">
<Class name="PEX.GCP.PubSub.Msg.Message">
<Super>%Persistent,%XML.Adaptor</Super>
<TimeChanged>65945,39725.223104</TimeChanged>
<TimeCreated>65932,29343.358923</TimeCreated>

<Property name="MessageID">
<Type>%String</Type>
<Parameter name="MAXLEN" value="512"/>
</Property>

<Property name="PublishTime">
<Type>%String</Type>
<Parameter name="MAXLEN" value="64"/>
</Property>

<Property name="OrderingKey">
<Type>%String</Type>
<Parameter name="MAXLEN" value="512"/>
</Property>

<Property name="StringData">
<Type>%Stream.GlobalCharacter</Type>
</Property>

<Property name="BinaryData">
<Type>%Stream.GlobalBinary</Type>
</Property>

<Property name="Attributes">
<Type>%String</Type>
<Collection>array</Collection>
<Parameter name="MAXLEN" value="8192"/>
</Property>

<Property name="IsBinary">
<Type>%Boolean</Type>
<InitialExpression>"0"</InitialExpression>
</Property>

<Method name="GetDataStream">
<ReturnType>%Stream.Object</ReturnType>
<Implementation><![CDATA[
	if ..IsBinary quit ..BinaryData
	quit ..StringData
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Storage.Persistent</Type>
<DataLocation>^PEX.GCP.PubSub.Msg.MessageD</DataLocation>
<DefaultData>MessageDefaultData</DefaultData>
<IdLocation>^PEX.GCP.PubSub.Msg.MessageD</IdLocation>
<IndexLocation>^PEX.GCP.PubSub.Msg.MessageI</IndexLocation>
<StreamLocation>^PEX.GCP.PubSub.Msg.MessageS</StreamLocation>
<Data name="Attributes">
<Attribute>Attributes</Attribute>
<Structure>subnode</Structure>
<Subscript>"Attributes"</Subscript>
</Data>
<Data name="MessageDefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>MessageID</Value>
</Value>
<Value name="3">
<Value>PublishTime</Value>
</Value>
<Value name="4">
<Value>StringData</Value>
</Value>
<Value name="5">
<Value>BinaryData</Value>
</Value>
<Value name="6">
<Value>IsBinary</Value>
</Value>
<Value name="7">
<Value>OrderingKey</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="PEX.GCP.PubSub.Msg.PublishResponse">
<Super>%Persistent,%XML.Adaptor</Super>
<TimeChanged>65945,38628.476874</TimeChanged>
<TimeCreated>65939,48652.702018</TimeCreated>

<Property name="MessageID">
<Type>%String</Type>
<Parameter name="MAXLEN" value="4096"/>
</Property>

<Method name="%OnNew">
<FormalSpec>pMessageID:%String</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<ServerOnly>1</ServerOnly>
<Implementation><![CDATA[
	set ..MessageID=pMessageID
	Quit $$$OK
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Storage.Persistent</Type>
<DataLocation>^PEX.GCP.PuB1F7.PublishResp79BDD</DataLocation>
<DefaultData>PublishResponseDefaultData</DefaultData>
<IdLocation>^PEX.GCP.PuB1F7.PublishResp79BDD</IdLocation>
<IndexLocation>^PEX.GCP.PuB1F7.PublishResp79BDI</IndexLocation>
<StreamLocation>^PEX.GCP.PuB1F7.PublishResp79BDS</StreamLocation>
<Data name="PublishResponseDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>MessageID</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="PEX.GCP.PubSub.Operation">
<Super>Ens.BusinessOperation</Super>
<TimeChanged>65947,34079.192912</TimeChanged>
<TimeCreated>65939,51308.793674</TimeCreated>

<Parameter name="ADAPTER">
<Default>EnsLib.PEX.OutboundAdapter</Default>
</Parameter>

<Property name="Adapter">
<Type>EnsLib.PEX.OutboundAdapter</Type>
</Property>

<Parameter name="SETTINGS">
<Description><![CDATA[
The "Remote Settings" field in the Business Operation settings should include the following:
<ul>
<li><u>LogLevel</u><br/>Default: INFO<br/>Level of detail for the adapter to log to the IRIS Event Log. Possible values, in ascending order of detail are OFF, FATAL, ERROR, WARN, INFO, DEBUG, TRACE<br/><br/></li>
<li><u>InternalQueueSize</u><br/>Default: 1000<br/>The maximum size of the internal message queue. Defaults to 1000</li>
<li><u>GCPCredentials</u><br/>Default: [NONE]<br/>This is a JSON string generated by GCP. Note: the JSON string should be flattened into only one line -- remove all carriage returns/linefeeds before entering the string into Remote Settings.<br/>Note: in the future this may be changed to use a credential entry in the production<br/><br/></li>
<li><u>GCPProjectID</u><br/>Default: [NONE]<br/>The GCP project that the subscription belongs to<br/><br/></li>
<li><u>GCPTopicID</u><br/>Default: [NONE]<br/>The GCP ID for the subscription to receive messages for<br/><br/></li>
</ul>
See PEX documentation for more information about the Remote Settings field.]]></Description>
</Parameter>

<Parameter name="INVOCATION">
<Default>Queue</Default>
</Parameter>

<Method name="PublishMessage">
<FormalSpec>pRequest:PEX.GCP.PubSub.Msg.Message,*pResponse:PEX.GCP.PubSub.Msg.PublishResponse</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set pResponse=..Adapter.%DispatchMethod("OnMessage",pRequest)
	Quit $$$OK
]]></Implementation>
</Method>

<XData name="MessageMap">
<Data><![CDATA[
<MapItems>
	<MapItem MessageType="PEX.GCP.PubSub.Msg.Message"> 
		<Method>PublishMessage</Method>
	</MapItem>
</MapItems>
]]></Data>
</XData>
</Class>


<Class name="PEX.GCP.PubSub.Service">
<Super>Ens.BusinessService</Super>
<TimeChanged>65947,34086.944689</TimeChanged>
<TimeCreated>65897,35262.18805</TimeCreated>

<Parameter name="ADAPTER">
<Default>EnsLib.PEX.InboundAdapter</Default>
</Parameter>

<Parameter name="SETTINGS">
<Description><![CDATA[
The "Remote Settings" field in the Business Service settings should include the following:
<ul>
<li><u>LogLevel</u><br/>Default: INFO<br/>Level of detail for the adapter to log to the IRIS Event Log. Possible values, in ascending order of detail are OFF, FATAL, ERROR, WARN, INFO, DEBUG, TRACE<br/><br/></li>
<li><u>InternalQueueSize</u><br/>Default: 1000<br/>The maximum size of the internal message queue. Defaults to 1000</li>
<li><u>MessageClass</u><br/>Default: PEX.GCP.PubSub.Msg.Message<br/>The fully qualified name of the IRIS message class that should be sent to OnProcessInput. Unless a custom message type is needed, use the default<br/><br/></li>
<li><u>GCPCredentials</u><br/>Default: [NONE]<br/>This is a JSON string generated by GCP. Note: the JSON string should be flattened into only one line -- remove all carriage returns/linefeeds before entering the string into Remote Settings.<br/>Note: in the future this may be changed to use a credential entry in the production<br/><br/></li>
<li><u>GCPProjectID</u><br/>Default: [NONE]<br/>The GCP project that the subscription belongs to<br/><br/></li>
<li><u>GCPSubscriptionID</u><br/>Default: [NONE]<br/>The GCP ID for the subscription to receive messages for<br/><br/></li>
<li><u>GCPTopicEncoding</u><br/>Default: JSON<br/>The encoding type for messages in this topic. This should be JSON (default) or BINARY and should match the setting in the GCP topic definition<br/><br/></li>
</ul>
See PEX documentation for more information about the Remote Settings field.]]></Description>
<Default><![CDATA[TargetConfigNames:Basic:selector?multiSelect=1&context={Ens.ContextSearch/ProductionItems?targets=1&productionName=@productionId}]]></Default>
</Parameter>

<Property name="TargetConfigNames">
<Type>%String</Type>
<Parameter name="MAXLEN" value="1000"/>
</Property>

<Method name="OnProcessInput">
<FormalSpec>pInput:%RegisteredObject,*pOutput:%RegisteredObject</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set tStatus = $$$OK
	set ..%WaitForNextCallInterval=1
	
	if $ISOBJECT(pInput) {
		for i=1:1:$length(..TargetConfigNames,",") {
			Set tStatus = ..SendRequestAsync($piece(..TargetConfigNames,",", i), pInput)
			If $$$ISERR(tStatus) Quit
		}
		set ..%WaitForNextCallInterval=0
	}

	quit tStatus
]]></Implementation>
</Method>

<Method name="OnInit">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set tStatus = ##super()
	
	throw:'$L(..TargetConfigNames) ##class(%Exception.StatusException).CreateFromStatus($$$ERROR(5001,"Must specify TargetConfigNames"))
	
	quit tStatus
]]></Implementation>
</Method>

<Method name="OnGetConnections">
<ClassMethod>1</ClassMethod>
<FormalSpec>*pArray:%String,pItem:Ens.Config.Item</FormalSpec>
<Implementation><![CDATA[
	Do ##super(.pArray,pItem)
	If pItem.GetModifiedSetting("TargetConfigNames",.tValue) {
		For i=1:1:$L(tValue,",") { Set tOne=$ZStrip($P(tValue,",",i),"<>W")  Continue:""=tOne  Set pArray(tOne)="" }
	}
]]></Implementation>
</Method>
</Class>


</Export>
